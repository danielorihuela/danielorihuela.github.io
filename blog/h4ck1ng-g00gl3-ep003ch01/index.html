<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.15.4"><!-- Canonical URL --><link rel="canonical" href="https://danielorihuela.github.io/blog/h4ck1ng-g00gl3-ep003ch01/"><!-- Primary Meta Tags --><title>H4ck1ng G00gl3 ep003 challenge 01</title><meta name="title" content="H4ck1ng G00gl3 ep003 challenge 01"><meta name="description" content="todo"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://danielorihuela.github.io/blog/h4ck1ng-g00gl3-ep003ch01/"><meta property="og:title" content="H4ck1ng G00gl3 ep003 challenge 01"><meta property="og:description" content="todo"><meta property="og:image" content="https://danielorihuela.github.io/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://danielorihuela.github.io/blog/h4ck1ng-g00gl3-ep003ch01/"><meta property="twitter:title" content="H4ck1ng G00gl3 ep003 challenge 01"><meta property="twitter:description" content="todo"><meta property="twitter:image" content="https://danielorihuela.github.io/blog-placeholder-1.jpg"><link rel="stylesheet" href="/_astro/_slug_.BVPmWECA.css">
<style>code[class*=language-],pre[class*=language-]{color:#f5f5f5;text-shadow:0 0 2px #100c0f,0 0 5px rgba(220,7,142,.2),0 0 10px rgba(255,255,255,.2);background:none;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#34294f}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#969896}.token.punctuation{color:#ccc}.token.selector{color:#72f1b8;text-shadow:0 0 2px #100c0f,0 0 10px rgba(37,124,85,.4588235294),0 0 35px rgba(33,39,36,.4588235294)}.token.function-name{color:#6196cc}.token.constant,.token.symbol{color:#f92aad;text-shadow:0 0 2px #100c0f,0 0 5px rgba(220,7,142,.2),0 0 10px rgba(255,255,255,.2)}.token.attr-value,.token.char,.token.regex,.token.variable{color:#f87c32}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.token.string{color:#90ee90}.token.class-name,.token.deleted,.token.directive.keyword+.token.string,.token.hexcode,.token.namespace,.token.tag,.token.unit{color:#fff;text-shadow:0 0 1px #ff4d4d,0 0 2px #ff4d4d,0 0 4px #ff4d4d,0 0 10px #ff4d4d,0 0 20px #ff4d4d}.token.macro{color:#fff;text-shadow:0 0 1px #f8d132,0 0 2px #f8d132,0 0 4px #f8d132,0 0 10px #f8d132,0 0 20px #f8d132}.token.attr-name,.token.boolean,.token.function,.token.selector .token.id{color:#fff;text-shadow:0 0 1px #00f2ff,0 0 2px #00f2ff,0 0 4px #00f2ff,0 0 10px #00f2ff,0 0 20px #00f2ff}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector .token.class,.token.token.directive-hash{color:#fff;text-shadow:0 0 1px #bd32f8,0 0 2px #bd32f8,0 0 4px #bd32f8,0 0 10px #bd32f8,0 0 20px #bd32f8}main[data-astro-cid-bvzihdzo]{width:100%;background-color:#222}.hero-image[data-astro-cid-bvzihdzo]{width:40ch;max-width:100%;margin:auto}.hero-image[data-astro-cid-bvzihdzo] img[data-astro-cid-bvzihdzo]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-bvzihdzo]{width:80ch;max-width:100%;margin:auto;color:#d3d3d3}.title[data-astro-cid-bvzihdzo]{margin-bottom:1rem;padding:1rem 0;text-align:center;line-height:1}.title[data-astro-cid-bvzihdzo] h1[data-astro-cid-bvzihdzo]{margin:0 0 .5rem}.date[data-astro-cid-bvzihdzo]{margin-bottom:.5rem;color:#fff}.last-updated-on[data-astro-cid-bvzihdzo]{font-style:italic}.title-name[data-astro-cid-bvzihdzo]{font-family:Iceland;color:#fff}.prose[data-astro-cid-bvzihdzo] img{display:flex;margin:0 auto 2em}.prose[data-astro-cid-bvzihdzo] p{margin-bottom:2em}
</style></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Home </a>  <a href="/about" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> About </a>  <a href="/blog" class="active" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Blog </a>  <a href="/open-source" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Open Source </a>  </div> </nav> </header>  <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="hero-image" data-astro-cid-bvzihdzo> <img src="/_astro/hacking-google-2022.Cm7LR77H_Z4aiM2.webp" alt="" data-astro-cid-bvzihdzo width="1024" height="1024" loading="lazy" decoding="async"> </div> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2022-11-09T00:00:00.000Z"> Nov 9, 2022 </time>  </div> <h1 class="title-name" data-astro-cid-bvzihdzo>H4ck1ng G00gl3 ep003 challenge 01</h1> <hr data-astro-cid-bvzihdzo> </div>  <ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#learning-journey">Learning Journey</a></li>
</ul>
<h1 id="introduction">Introduction</h1>
<p><a href="https://h4ck1ng.google/">H4ck1ng G00gl3</a> is a series of security
challenges published on <strong>October 2022</strong> where the only way to win is to
think like a hacker. In this post, I explain how I solved <strong>ep003
challenge 01</strong>. Category <strong>Misc</strong>.</p>
<h1 id="learning-journey">Learning Journey</h1>
<p><img  src="/_astro/intro.DK2MIJkE_Z1N9OT2.webp" alt="" width="439" height="157" loading="lazy" decoding="async"></p>
<p>The description tell us how to connect to the machine with socat.
However, it requires a password. I tried to guess it with no luck. I
watched the episode video again but didn’t find anything interesting. I
even tried searching for vulnerabilities or brute force scripts
targeting socat. Nothing of that worked. I asked the community for a
hint. They told me to check the <strong>intro</strong> tab of the episode.</p>
<p><img  src="/_astro/password-hint.DTfq6Eyt_ZBokjK.webp" alt="" width="707" height="404" loading="lazy" decoding="async"></p>
<p>I believe I never read the introductions to the different challenges,
but it was necessary this time. There, we can see two times at which the
episode video might show something interesting. If we <strong>stop the episode
at 15:09</strong> we will see the password.</p>
<p><img  src="/_astro/video-password.BpN6W0mb_Z1aJwnp.webp" alt="" width="998" height="559" loading="lazy" decoding="async"></p>
<p>We can access the machine now.</p>
<p><img  src="/_astro/developer-shell.fhl2s91N_Z7s6Na.webp" alt="" width="1040" height="261" loading="lazy" decoding="async"></p>
<p>In the home directory, we find three files: backup.py, login.sh and
todo.txt. The login.sh contains the code executed when connecting with
socat, nothing of interest. However, the other two files contain
relevant information. I decided to check the <strong>backup.py</strong> first.</p>
<p><img  src="/_astro/backup-code.B6VS6mGC_Z2fCnhw.webp" alt="" width="928" height="985" loading="lazy" decoding="async"></p>
<p>It’s a simple unfinished script. The script creates the backup of a
document, probably the one we need to get. The problem is that <strong>we need
an access token to get the file</strong>. Unlucky for us, the function that
gets the token hasn’t been implemented. In any case, we can see framed
in red the base URL and the document id. Hence, we know the document is
at
<a href="https://docs.googleapis.com/v1/documents/1Z7CQDJhCj1G5ehvM3zB3FyxsCfdvierd1fs0UBlzFFM">https://docs.googleapis.com/v1/documents/1Z7CQDJhCj1G5ehvM3zB3FyxsCfdvierd1fs0UBlzFFM</a>.
Besides, we have to use <strong>RFC 6749: The OAuth 2.0 Authorization
framework</strong>. We know it from the challenge hint,
<code>Hint: Find the key, and put RFC 6749 to use</code>. That means we need to get
the <strong>access token</strong> using the <strong>OAuth 2.0 framework</strong>. I wrote this
down and kept collecting information.</p>
<p>I opened the <strong>todo.txt</strong> file and saw the following:</p>
<pre class="language-txt" data-language="txt"><code is:raw="" class="language-txt">Today
[x] Added backup-tool@project-multivision.iam.gserviceaccount.com with viewer-access to super sensitive design doc
[x] Tried activating service account with gcloud, but didn't give me a documents.readonly scope
[x] Cleaned up service account key from disk before signing off

Tomorrow
[] Finish writing Google Drive backup script
</code></pre>
<p>We can read that the developer used a <strong>service account with gcloud</strong>.
He also mentions something about a <strong>“documents.readonly” scope</strong> and
that he removed the key from the disk. That is unfortunate because we
need it to get the access token.</p>
<p>At this point, I did not know what to do or how to proceed. I read
diagonally the RFC 6749 and searched for information about OAuth2.0 on
internet but did not find anything that could help me. For no reason, I
thought it was worth returning to the developer machine to navigate the
directories and see if I could find anything. After some time, I found
something that caught my attention. A <strong>hidden folder named “.config</strong>”.</p>
<p><img  src="/_astro/ls-hidden.B5fMMFGh_Z1mPFzF.webp" alt="" width="921" height="348" loading="lazy" decoding="async"></p>
<p>This folder contains a <strong>gcloud folder with promising files</strong>.</p>
<p><img  src="/_astro/gcloud-config-files.t9hg4pWJ_ZMdBVe.webp" alt="" width="981" height="87" loading="lazy" decoding="async"></p>
<p>Remember that we needed an access token? Well…, there we have a
<strong>access_tokens.db</strong>, which includes <strong>an old access token and a JWT</strong>.</p>
<p><img  src="/_astro/old-access-token.Dl8qvFCN_Z2egMJz.webp" alt="" width="1920" height="495" loading="lazy" decoding="async"></p>
<p>We can paste the token into the <a href="https://jwt.io/">https://jwt.io/</a> webpage and see which
information is inside.</p>
<p><img  src="/_astro/decoded-access-token.IsEGLcrt_ZYOr8k.webp" alt="" width="590" height="531" loading="lazy" decoding="async"></p>
<p>We are progressing. Still, we don’t know the information we have to
include in the JWT to get a new access token, and we don’t have the
private key to sign it. I returned to the <strong>.config/gcloud</strong> folder to
search for the private key. There, we see a file called
<strong>credentials.db</strong>, which contains the <strong>private key</strong> and the <strong>token
URI</strong>, among other information we don’t need.</p>
<p><img  src="/_astro/private-key.fJE7szdg_ZYmk33.webp" alt="" width="1002" height="343" loading="lazy" decoding="async"></p>
<p>Now we have all the required information.</p>
<ul>
<li>JWT with some information</li>
<li>Private key to sign the token</li>
<li>document URL</li>
<li>Token URI to get the access token</li>
<li>The backup is done with a service account</li>
<li>The scope is related to documents.readonly</li>
</ul>
<p>We only need to find the correct steps we have to follow to get a valid
access token and eventually get the document. After wandering through
several blogs, tutorials, videos and documentation, I found some Google
documentation explaining <a href="https://developers.google.com/identity/protocols/oauth2/service-account#authorizingrequests">how to use OAuth 2.0 for Server to Server
Application</a>.
There, we can see the information the access token must contain and how
to send the POST request. First, we have to build a valid access token.</p>
<p><img  src="/_astro/new-jwt.lQFNxI0j_2aVDfA.webp" alt="" width="1074" height="795" loading="lazy" decoding="async"></p>
<p>The header stays the same. However, we needed to modify the payload. The
<strong>iat field timestamp is the current timestamp</strong>, and the <strong>exp field
timestamp is one hour from now in the future</strong>. Moreover, we initially
<strong>set the scope field to
“<a href="https://www.googleapis.com/auth/documents.readonly">https://www.googleapis.com/auth/documents.readonly</a>”</strong>. We can see the
different authorization scopes available for a document GET request at
<a href="https://developers.google.com/docs/api/reference/rest/v1/documents/get">https://developers.google.com/docs/api/reference/rest/v1/documents/get</a>.
We are now in good shape to <strong>send a POST request to get a valid
access_token</strong>.</p>
<p><img  src="/_astro/post-token.CXC6S47L_J6lwR.webp" alt="" width="1824" height="790" loading="lazy" decoding="async"></p>
<p>Great, we got a new access token! The last step is <strong>sending a GET
request to the document URL</strong> with the <strong>access token in the
Authorization header</strong>.</p>
<p><img  src="/_astro/get-blueprints.HBrCKSo6_Z2wdudo.webp" alt="" width="1245" height="818" loading="lazy" decoding="async"></p>
<p>Perfect! We received the response with the blueprints! Finally, we need
to search for the flag in the response. With that, we completed the
challenge.</p>
<p><img  src="/_astro/intro.DK2MIJkE_Z1N9OT2.webp" alt="" width="439" height="157" loading="lazy" decoding="async"></p>  </div> </article> </main> <footer></footer> </body></html>